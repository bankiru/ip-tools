<?php
namespace Bankiru\IPTools\Converters;

class NetmaskTest extends ConvertersTestBase
{

    /**
     * @return array
     */
    public function provide_valid_parse()
    {
        $validNetmasks = array(
            '255.255.255.255',
            '255.255.255.254',
            '255.255.255.252',
            '255.255.255.248',
            '255.255.255.240',
            '255.255.255.224',
            '255.255.255.192',
            '255.255.255.128',
            '255.255.255.0',
            '255.255.254.0',
            '255.255.252.0',
            '255.255.248.0',
            '255.255.240.0',
            '255.255.224.0',
            '255.255.192.0',
            '255.255.128.0',
            '255.255.0.0',
            '255.254.0.0',
            '255.252.0.0',
            '255.248.0.0',
            '255.240.0.0',
            '255.224.0.0',
            '255.192.0.0',
            '255.128.0.0',
            '255.0.0.0',
            '254.0.0.0',
            '252.0.0.0',
            '248.0.0.0',
            '240.0.0.0',
            '224.0.0.0',
            '192.0.0.0',
            '128.0.0.0',
            '0.0.0.0',
        );

        return array_map(
            function ($netmask) {
                $ip = ip2long('10.0.0.1' . (rand(0, 1) ? '' : '28'));
                $bits = Cidr::countSetBits(ip2long($netmask));
                $bitmask = $bits == 0 ? 0 : (~0 << (32 - $bits));
                $start = $ip & $bitmask;
                $end = $ip | (~$bitmask & 0xFFFFFFFF);

                return array(
                    long2ip($ip) . '/' . $netmask,
                    $start,
                    $end,
                );
            },
            $validNetmasks
        );
    }

    /**
     * @return array
     */
    public function provide_invalid_parse()
    {
        return array(
            array('23.14.77.19'),
            array('192.168.*.7'),
            array('192.168.0.1/24'),
            array('192.168.43.100-192.168.45.7'),
            array('1.0.0.1/256.0.0.0'),
            array('1.0.256.1/255.0.0.0'),
        );
    }

    /**
     * @return array
     */
    public function provide_valid_stringify()
    {
        return array(
            array('192.168.0.7', '192.168.0.7', '192.168.0.7/255.255.255.255'),
            array('192.168.0.0', '192.168.0.255', '192.168.0.0/255.255.255.0'),
            array('10.0.168.5', '10.0.169.100', '10.0.168.5/255.255.255.255,10.0.168.6/255.255.255.254,10.0.168.8/255.255.255.248,10.0.168.16/255.255.255.240,10.0.168.32/255.255.255.224,10.0.168.64/255.255.255.192,10.0.168.128/255.255.255.128,10.0.169.0/255.255.255.192,10.0.169.64/255.255.255.224,10.0.169.96/255.255.255.252,10.0.169.100/255.255.255.255'),
        );
    }

    /**
     * @return array
     */
    public function provide_invalid_stringify()
    {
        return array(array('192.168.0.7', '192.168.0.6'));
    }
}
